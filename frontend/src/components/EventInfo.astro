---
import CalendarDays from 'astro-heroicons/outline/CalendarDays.astro'
import Map from 'astro-heroicons/outline/Map.astro'
import { getCollection } from 'astro:content'
import Button from '../components/shared/Button.astro'
import DynamicImage from './shared/DynamicImage.astro'
import * as contactSettings from '../content/pages/contact-settings.md'
import * as eventContent from '../content/pages/current-larp-event.md'
import StyledMarkdown from './shared/StyledMarkdown.astro'
import ViewTracker from './shared/ViewTracker.astro'

interface Props {
  eventName: string,
  displayHeading?: boolean
}

const { eventName, displayHeading = true } = Astro.props
const eventColection = await getCollection(
  'events',
  ({ data }: { data: any }) => data.title == eventName,
)
if (!eventColection || eventColection.length === 0) {
  throw new Error(`Event with name ${eventName} not found`)
}
const event = eventColection[0].data
---

{ displayHeading &&
<div class='flex-column flex justify-center pb-4'>
  <h2
    class='font-display flex md:underlined-heading mx-2 text-4xl uppercase tracking-tight text-zinc-900 md:text-5xl'>
    {event.title}
  </h2>
</div>
}
<ViewTracker eventName="EventInfo">
<div class='relative mx-auto max-w-5xl'>

  <!-- Hero image -->
  <div class='relative overflow-hidden rounded-lg shadow-inner max-h-[30rem]'>
    <DynamicImage src={event.image} class:list={'object-cover object-center shadow-inner'}/>
    { event.archived &&
    <div
    class="absolute inset-0 bg-emerald-800/60 backdrop-blur-sm text-zinc-300/95 content-center text-center font-large text-6xl">
      {eventContent.frontmatter.archive_text}
    </div>
    }
  </div>

  { event.archived ?
  <!-- Newsletter CTA -->
  <div class='absolute w-2/3 bottom-40 right-8 rounded-lg flex flex-row border-2 border-yellow-500 bg-zinc-50 p-8 shadow-md md:right-[calc(50%-theme(space.48))]'>
    <div class='font-medium text-lg text-emerald-950 pr-8 self-center'>
      { eventContent.frontmatter.newsletter_text }
    </div>
    <Button text={eventContent.frontmatter.newsletter_button_text} href={contactSettings.frontmatter.newsletter_link} class:list={'self-center'} />
  </div>

  <!-- Socials CTA -->
  <div class='m-16 mt-40 gap-2 mx-auto flex max-w-5xl bg-zinc-50 flex-col'>
    <div class='flex self-center'>Alebo nás sleduj na sociálnych sieťach</div>
    <div class='mx-8 flex self-center columns-3 fill-emerald-900 pt-2'>
      <a href={contactSettings.frontmatter.instagram} class='mx-4 rounded-md hover:bg-yellow-50 hover:shadow-sm' aria-label='Instagram'>
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50' width='32px' height='32px'
          ><path
            d='M 24.849609 10 C 11.077609 10 10 11.077609 10 24.849609 L 10 25.150391 C 10 38.922391 11.077609 40 24.849609 40 L 25.150391 40 C 38.922391 40 40 38.922391 40 25.150391 L 40 24.849609 C 40 11.077609 38.922391 10 25.150391 10 L 24.849609 10 z M 23.751953 11 L 26.248047 11 C 38.074047 11 39 11.925953 39 23.751953 L 39 26.248047 C 39 38.074047 38.074047 39 26.248047 39 L 23.751953 39 C 11.925953 39 11 38.074047 11 26.248047 L 11 23.751953 C 11 11.925953 11.925953 11 23.751953 11 z M 33.496094 15 C 32.668094 15.002 31.998 15.674906 32 16.503906 C 32.002 17.331906 32.674906 18.002 33.503906 18 C 34.331906 17.998 35.002 17.325094 35 16.496094 C 34.998 15.668094 34.325094 14.998 33.496094 15 z M 24.980469 17 C 20.562469 17.011 16.989 20.601531 17 25.019531 C 17.01 29.437531 20.601531 33.011 25.019531 33 C 29.437531 32.99 33.011 29.398469 33 24.980469 C 32.99 20.562469 29.398469 16.989 24.980469 17 z M 24.982422 18 C 28.848422 17.991 31.991 21.116422 32 24.982422 C 32.009 28.848422 28.883578 31.991 25.017578 32 C 21.151578 32.009 18.009 28.883578 18 25.017578 C 17.991 21.151578 21.116422 18.009 24.982422 18 z'
          ></path>
        </svg>
      </a>
      <a href={contactSettings.frontmatter.discord} class='mx-4 rounded-md hover:bg-yellow-50 hover:shadow-sm' aria-label='Discord'>
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50' width='32px' height='32px'
          ><path
            d='M 20.4375 9.2226562 C 16.4885 9.5946562 11.939453 11.824219 11.939453 11.824219 C 11.939453 11.824219 6 18.386641 6 30.681641 L 6 33.65625 L 6.453125 33.951172 C 7.668125 34.742172 13.844062 38.691406 16.164062 38.691406 L 16.691406 38.691406 L 19.365234 34.804688 C 20.943234 35.184687 22.889 35.498047 25 35.498047 C 27.111 35.498047 29.055766 35.184688 30.634766 34.804688 L 33.308594 38.691406 L 33.835938 38.691406 C 36.155938 38.691406 42.331875 34.742172 43.546875 33.951172 L 44 33.65625 L 44 30.681641 C 44 18.423641 38.060547 11.824219 38.060547 11.824219 C 38.060547 11.824219 33.2945 9.5396563 29.5625 9.2226562 L 28.490234 11.255859 C 27.734234 11.131859 26.48 10.972656 25 10.972656 C 23.519 10.972656 22.265766 11.131859 21.509766 11.255859 L 20.4375 9.2226562 z M 19.880859 10.308594 L 20.970703 12.375 C 20.970703 12.375 22.703 11.974609 25 11.974609 C 27.297 11.974609 29.029297 12.375 29.029297 12.375 L 30.119141 10.308594 C 33.633141 10.792594 37.4375 12.634766 37.4375 12.634766 C 37.4375 12.634766 43 19.077641 43 30.681641 L 43 33.113281 C 43 33.113281 35.976891 37.691406 33.837891 37.691406 L 31.759766 34.671875 C 33.049766 34.093875 34.810547 33.089844 34.810547 33.089844 L 34.167969 32.591797 C 34.167969 32.591797 30.052953 34.498047 25.001953 34.498047 C 19.950953 34.498047 15.835938 32.591797 15.835938 32.591797 L 15.191406 33.089844 C 15.191406 33.089844 16.951187 34.093875 18.242188 34.671875 L 16.164062 37.691406 C 14.023063 37.691406 7 33.113281 7 33.113281 L 7 30.681641 C 7 19.077641 12.5625 12.634766 12.5625 12.634766 C 12.5625 12.634766 16.366859 10.793594 19.880859 10.308594 z M 18.673828 21.660156 C 16.804828 21.660156 15.289062 23.361937 15.289062 25.460938 C 15.289062 27.559938 16.804828 29.261719 18.673828 29.261719 C 20.541828 29.261719 22.057594 27.560938 22.058594 25.460938 C 22.058594 23.361937 20.542828 21.660156 18.673828 21.660156 z M 31.326172 21.660156 C 29.457172 21.660156 27.941406 23.361937 27.941406 25.460938 C 27.941406 27.559938 29.457172 29.261719 31.326172 29.261719 C 33.195172 29.261719 34.710938 27.560938 34.710938 25.460938 C 34.710938 23.361937 33.195172 21.660156 31.326172 21.660156 z'
          ></path>
        </svg>
      </a>
      <a href={contactSettings.frontmatter.facebook} class='mx-4 rounded-md hover:bg-yellow-50 hover:shadow-sm' aria-label='Facebook'>
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50' width='32px' height='32px'
          ><path
            d='M 17.722656 10 C 10.560656 10 10 10.560656 10 17.722656 L 10 32.277344 C 10 39.439344 10.560656 40 17.722656 40 L 32.277344 40 C 39.439344 40 40 39.439344 40 32.277344 L 40 17.769531 C 40 10.563531 39.436469 10 32.230469 10 L 17.722656 10 z M 17 11 L 33 11 C 38.565 11 39 11.435 39 17 L 39 33 C 39 38.565 38.565 39 33 39 L 29.712891 39 L 29.712891 29.355469 L 33.453125 29.355469 L 34.013672 24.894531 L 29.714844 24.894531 L 29.714844 21.771484 C 29.714844 20.534484 30.5495 19.900391 31.4375 19.900391 C 32.3255 19.900391 34.164062 19.875 34.164062 19.875 L 34.164062 15.884766 C 34.164062 15.884766 32.528422 15.695312 30.857422 15.695312 C 29.453422 15.695312 27.907922 16.091234 26.669922 17.365234 C 25.410922 18.660234 25.228516 20.57225 25.228516 22.90625 L 25.228516 24.896484 L 21.478516 24.896484 L 21.478516 29.357422 L 25.228516 29.357422 L 25.228516 39 L 17 39 C 11.435 39 11 38.565 11 33 L 11 17 C 11 11.435 11.435 11 17 11 z'
          ></path>
        </svg>
      </a>
    </div>
  </div>

  :

  <!-- Event basic info -->
  <div
    class='absolute -bottom-48 md:-bottom-32 mx-4 m-8 max-w-[90vw] md:max-w-96 space-y-4 rounded-lg border-2 border-yellow-500 bg-zinc-100 p-8 shadow-md md:right-[calc(25%-theme(space.48))]'>
    <div class='font-medium text-zinc-950'>
      <CalendarDays class='mr-1 inline h-5 align-top text-emerald-800' />
      <p class='inline'>
        {event.date}
      </p>
    </div>
    <div class='font-medium text-zinc-950'>
      <Map class='mr-1 inline h-5 align-top text-emerald-800' />
      <p class='inline'>
        {event.place}
      </p>
    </div>

    <!-- Socials -->
    <div class='mx-8 flex max-w-[400px] columns-3 justify-center fill-emerald-900 pt-2'>
      <a href={contactSettings.frontmatter.instagram} class='mx-4 rounded-md hover:bg-yellow-50 hover:shadow-sm' aria-label='Instagram'>
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50' width='32px' height='32px'
          ><path
            d='M 24.849609 10 C 11.077609 10 10 11.077609 10 24.849609 L 10 25.150391 C 10 38.922391 11.077609 40 24.849609 40 L 25.150391 40 C 38.922391 40 40 38.922391 40 25.150391 L 40 24.849609 C 40 11.077609 38.922391 10 25.150391 10 L 24.849609 10 z M 23.751953 11 L 26.248047 11 C 38.074047 11 39 11.925953 39 23.751953 L 39 26.248047 C 39 38.074047 38.074047 39 26.248047 39 L 23.751953 39 C 11.925953 39 11 38.074047 11 26.248047 L 11 23.751953 C 11 11.925953 11.925953 11 23.751953 11 z M 33.496094 15 C 32.668094 15.002 31.998 15.674906 32 16.503906 C 32.002 17.331906 32.674906 18.002 33.503906 18 C 34.331906 17.998 35.002 17.325094 35 16.496094 C 34.998 15.668094 34.325094 14.998 33.496094 15 z M 24.980469 17 C 20.562469 17.011 16.989 20.601531 17 25.019531 C 17.01 29.437531 20.601531 33.011 25.019531 33 C 29.437531 32.99 33.011 29.398469 33 24.980469 C 32.99 20.562469 29.398469 16.989 24.980469 17 z M 24.982422 18 C 28.848422 17.991 31.991 21.116422 32 24.982422 C 32.009 28.848422 28.883578 31.991 25.017578 32 C 21.151578 32.009 18.009 28.883578 18 25.017578 C 17.991 21.151578 21.116422 18.009 24.982422 18 z'
          ></path></svg>
      </a>
      <a href={contactSettings.frontmatter.discord} class='mx-4 rounded-md hover:bg-yellow-50 hover:shadow-sm' aria-label='Discord'>
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50' width='32px' height='32px'
          ><path
            d='M 20.4375 9.2226562 C 16.4885 9.5946562 11.939453 11.824219 11.939453 11.824219 C 11.939453 11.824219 6 18.386641 6 30.681641 L 6 33.65625 L 6.453125 33.951172 C 7.668125 34.742172 13.844062 38.691406 16.164062 38.691406 L 16.691406 38.691406 L 19.365234 34.804688 C 20.943234 35.184687 22.889 35.498047 25 35.498047 C 27.111 35.498047 29.055766 35.184688 30.634766 34.804688 L 33.308594 38.691406 L 33.835938 38.691406 C 36.155938 38.691406 42.331875 34.742172 43.546875 33.951172 L 44 33.65625 L 44 30.681641 C 44 18.423641 38.060547 11.824219 38.060547 11.824219 C 38.060547 11.824219 33.2945 9.5396563 29.5625 9.2226562 L 28.490234 11.255859 C 27.734234 11.131859 26.48 10.972656 25 10.972656 C 23.519 10.972656 22.265766 11.131859 21.509766 11.255859 L 20.4375 9.2226562 z M 19.880859 10.308594 L 20.970703 12.375 C 20.970703 12.375 22.703 11.974609 25 11.974609 C 27.297 11.974609 29.029297 12.375 29.029297 12.375 L 30.119141 10.308594 C 33.633141 10.792594 37.4375 12.634766 37.4375 12.634766 C 37.4375 12.634766 43 19.077641 43 30.681641 L 43 33.113281 C 43 33.113281 35.976891 37.691406 33.837891 37.691406 L 31.759766 34.671875 C 33.049766 34.093875 34.810547 33.089844 34.810547 33.089844 L 34.167969 32.591797 C 34.167969 32.591797 30.052953 34.498047 25.001953 34.498047 C 19.950953 34.498047 15.835938 32.591797 15.835938 32.591797 L 15.191406 33.089844 C 15.191406 33.089844 16.951187 34.093875 18.242188 34.671875 L 16.164062 37.691406 C 14.023063 37.691406 7 33.113281 7 33.113281 L 7 30.681641 C 7 19.077641 12.5625 12.634766 12.5625 12.634766 C 12.5625 12.634766 16.366859 10.793594 19.880859 10.308594 z M 18.673828 21.660156 C 16.804828 21.660156 15.289062 23.361937 15.289062 25.460938 C 15.289062 27.559938 16.804828 29.261719 18.673828 29.261719 C 20.541828 29.261719 22.057594 27.560938 22.058594 25.460938 C 22.058594 23.361937 20.542828 21.660156 18.673828 21.660156 z M 31.326172 21.660156 C 29.457172 21.660156 27.941406 23.361937 27.941406 25.460938 C 27.941406 27.559938 29.457172 29.261719 31.326172 29.261719 C 33.195172 29.261719 34.710938 27.560938 34.710938 25.460938 C 34.710938 23.361937 33.195172 21.660156 31.326172 21.660156 z'
          ></path></svg>
      </a>
      <a href={event.linkFbEvent} class='mx-4 rounded-md hover:bg-yellow-50 hover:shadow-sm' aria-label='Facebook'>
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50' width='32px' height='32px'
          ><path
            d='M 17.722656 10 C 10.560656 10 10 10.560656 10 17.722656 L 10 32.277344 C 10 39.439344 10.560656 40 17.722656 40 L 32.277344 40 C 39.439344 40 40 39.439344 40 32.277344 L 40 17.769531 C 40 10.563531 39.436469 10 32.230469 10 L 17.722656 10 z M 17 11 L 33 11 C 38.565 11 39 11.435 39 17 L 39 33 C 39 38.565 38.565 39 33 39 L 29.712891 39 L 29.712891 29.355469 L 33.453125 29.355469 L 34.013672 24.894531 L 29.714844 24.894531 L 29.714844 21.771484 C 29.714844 20.534484 30.5495 19.900391 31.4375 19.900391 C 32.3255 19.900391 34.164062 19.875 34.164062 19.875 L 34.164062 15.884766 C 34.164062 15.884766 32.528422 15.695312 30.857422 15.695312 C 29.453422 15.695312 27.907922 16.091234 26.669922 17.365234 C 25.410922 18.660234 25.228516 20.57225 25.228516 22.90625 L 25.228516 24.896484 L 21.478516 24.896484 L 21.478516 29.357422 L 25.228516 29.357422 L 25.228516 39 L 17 39 C 11.435 39 11 38.565 11 33 L 11 17 C 11 11.435 11.435 11 17 11 z'
          ></path></svg>
      </a>
    </div>
  </div>
  }
</div>
</ViewTracker>
{ !event.archived &&
<div class='m-4 mx-auto flex max-w-5xl flex-col bg-zinc-50 md:flex-row'>
  <div class='mt-36 text-zinc-900 md:mt-8 md:w-1/2'>
    <h3 class='font-large p-8 pl-4 text-2xl font-bold'>
      {event.subTitle}
    </h3>
    <div class='leading-relaxed text-base px-4'>
      <StyledMarkdown of={event.annotation} />
    </div>
  </div>
  <div class='md:mt-18 mt-10 flex flex-col items-center justify-center px-4 md:w-1/2'>
  <Button text='Registrácia' href='/larp-event#larp-registration' />
</div>
}
</div>  
